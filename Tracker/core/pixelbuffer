/*
 * PixelBuffer
 *
 *  Created on: 21.10.2014
 *      Author: akin
 */

#ifndef APP_PIXELBUFFER_HPP_
#define APP_PIXELBUFFER_HPP_

#include <stdtypes>
#include <colorsource>
#include <colortools>

template <class CType>
class PixelBuffer : public ColorSource
{
private:
	uint width;
	uint height;
	uint size;
	
	CType *data;
public:
	PixelBuffer()
	: data(nullptr)
	, width(0)
	, height(0)
	, size(0)
	{
	}

	virtual ~PixelBuffer()
	{
		delete[] data;
		data = nullptr;
	}

	template <class TType>
	void init( const PixelBuffer<TType>& other )
	{
		init( other.getWidth() , other.getHeight() );
	}

	void init( uint width , uint height )
	{
		this->width = width;
		this->height = height;

		this->size = this->width * this->height;

		this->data = new CType[this->size];
	}

	uint getWidth() const
	{
		return width;
	}

	uint getHeight() const
	{
		return height;
	}
	
	virtual void get( const float& at , Color& color ) const
	{
		uint index = ((uint)at) % this->width;
		
		if( index >= this->size )
		{
			throw "NOOO";
		}
		convert( color , data[index] );
	}
	
	virtual void get( const glm::vec2& at , Color& color ) const
	{
		uint x = ((uint)at.x) % this->width;
		uint y = ((uint)at.y) % this->height;
		
		uint index = ((y*this->width)+x);
		
		if( index >= this->size )
		{
			throw "NOOO";
		}
		convert( color , data[index] );
	}
	
	virtual void get( const glm::vec3& at , Color& color ) const
	{
		uint x = ((uint)at.x) % this->width;
		uint y = ((uint)at.y) % this->height;
		
		uint index = ((y*this->width)+x);
		
		if( index >= this->size )
		{
			throw "NOOO";
		}
		convert( color , data[index] );
	}

	uint getSize() const
	{
		return size;
	}

	CType *getBuffer() const
	{
		return data;
	}

	void set( uint width , uint height , const CType& pixel )
	{
		width %= this->width;
		height %= this->height;
		uint index = ((height*this->width)+width);
		
		if( index >= this->size )
		{
			throw "NOOO";
		}

		data[index] = pixel;
	}
};

#endif // APP_PIXELBUFFER_HPP_
